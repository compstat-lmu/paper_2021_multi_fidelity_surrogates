---
title: "Fitting Surrogates"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{fitting_surrogates}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
reticulate::use_condaenv('mlr3keras', required = TRUE)
devtools::load_all()
```


Creating a **BenchmarkConfig**:

All benchmarks have an associated **BenchmarkConfig** that contains paths to relevant files and other configurations required.

In order to fit surrogates or to get the objective we first instantiate the **Config** object.

```{r}
workdir = paste0(path.expand("~"), "/LRZ Sync+Share/multifidelity_data/")
cfg = BenchmarkConfigNB301$new(workdir = workdir)
```

or alternatively use the sugar:

```{r}
cfg = cfgs('nb301', workdir = workdir)
```

and start fitting a surrogate:

```{r}
cfg$fit_surrogate()
```

We can adjust the NeuralNet architecture and fitting parameters by supplying a `model_config`.

```{r}
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config)
```

**NOTE** per default, models are not saved. We can enable this by supplying `overwrite = TRUE`.

The same holds for all other models:



## LCBench

```{r}
cfg = cfgs('rbv2_svm', workdir = workdir)
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config)
```


## SVM

```{r}
cfg = cfgs('rbv2_svm', workdir = workdir)
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config)
```

## Ranger

```{r}
cfg = cfgs('rbv2_ranger', workdir = workdir)
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config, overwrite = TRUE)
```

## GLMNET

```{r}
cfg = cfgs('rbv2_glmnet', workdir = workdir)
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config, overwrite = TRUE)
```

## RPART

```{r}
cfg = cfgs('rbv2_rpart', workdir = workdir)
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config, overwrite = TRUE)
```

## XGBOOST

```{r, eval = FALSE}
cfg = cfgs('rbv2_xgboost', workdir = workdir)
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config, overwrite = TRUE)
```


## Aproximate KNN (aknn)

```{r, eval = FALSE}
cfg = cfgs('rbv2_aknn', workdir = workdir)
model_config = default_model_config()
model_config$epochs = 1L
cfg$fit_surrogate(model_config = model_config, overwrite = TRUE)
```
